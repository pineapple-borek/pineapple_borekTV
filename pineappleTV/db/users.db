import sqlite3

# Veritabanı bağlantısı
conn = sqlite3.connect('db/users.db')

# Veritabanı şeması güncellemesi
def update_db_schema():
    cursor = conn.cursor()

    # Kullanıcılar tablosuna email ve kart bilgisi sütunlarını ekleyelim
    cursor.execute('PRAGMA table_info(users)')
    columns = [column[1] for column in cursor.fetchall()]

    if 'email' not in columns:
        cursor.execute('ALTER TABLE users ADD COLUMN email TEXT')
        print("email sütunu eklendi.")
    
    if 'card_info' not in columns:
        cursor.execute('ALTER TABLE users ADD COLUMN card_info TEXT')
        print("card_info sütunu eklendi.")
    
    conn.commit()

# Kullanıcılar tablosunu oluştur
conn.execute('''
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        username TEXT UNIQUE NOT NULL,
        password TEXT NOT NULL,
        subscription_end_date TEXT,  -- Üyelik bitiş tarihi sütunu eklendi
        email TEXT,  -- E-mail sütunu eklendi
        card_info TEXT  -- Kart bilgisi sütunu eklendi
    )
''')

# Favoriler tablosunu oluştur
conn.execute('''
    CREATE TABLE IF NOT EXISTS favorites (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        username TEXT,
        video_name TEXT
    )
''')

# Veritabanı işlemleri tamamlanır
conn.commit()

print("Veritabanı ve tablolar başarıyla oluşturuldu.")

# Şemayı güncelle
update_db_schema()

conn.close()
